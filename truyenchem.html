<!-- (\w+)\s+(\w+)\s+(.+) -->
<!-- {word: "$1", types: "$2", mean: "$3"}, -->

<!DOCTYPE html>
<html>
<head>
  <title>3000 Words</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-sanitize.js"></script>

  <script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
</head>


<body ng-app="myApp">
    <div ng-controller="ctrl" class="container mt-4">
    <h4 class="mb-4">Truyện chêm</h4>
    	<a href="./index.html" class="mt-2">3000 Words</a>
    	<button class="btn btn-sm btn-info float-right" ng-click="bEngToVi = !bEngToVi">{{bEngToVi == 1 ? 'en->vi' : 'vi->en' }}</button>
    	
    	<div class="my-3">
    		<button class="btn btn-sm btn-info" ng-if="storyIdx > 0" ng-click="fetchStory(-1)">Prev. Story</button>
    		<button class="btn btn-sm btn-info" ng-if="storyIdx < (stories.length - 1)" ng-click="fetchStory(1)">Next Story</button>
    	</div>

		<div class="card mt-4">
		    <div class="card-body">
	          <div class="card-text my-2">
	          	<p ng-repeat="(index, sentence) in story.engs" ng-if="bEngToVi" ng-click="playSentence(index)">{{sentence}}</p>
	          	<p ng-bind-html="story.vi" ng-if="!bEngToVi"></p>
	          </div> <!-- card-text -->
	          <button class="btn btn-info mr-2" ng-click="playFullSound($index)">{{bPlaying ? (bPause ? 'Resume' : 'Pause') : 'Play'}}</button>
	          <button class="btn btn-info" ng-if="bPlaying" ng-click="stopSound()">Stop</button>
        	</div> 		<!-- card-body -->
		 </div> <!-- card -->
    </div> <!-- container -->
</body>

<script type="text/javascript">
    var app = angular.module("myApp", ['ngSanitize']);
    app.controller("ctrl", function($scope, $timeout) {

     $scope.storyIdx = 0;
     $scope.bPlaying = false;
     $scope.bPause = false;
     $scope.bEngToVi = 1;
     $scope.audio;
     $scope.currentTime = 0;

    $scope.stories = [
{
	engs: 
	[
	"1.1 The Lion and the Rabbit",
	"A ………….. lion lived in the forest. Every day, he killed and ate a …………..of animals. The other animals were …………..the lion would kill them all.",
	"The animals told the lion, “ Let’s make a deal. If you …………..to eat only one animal each day, then one of us will come to you every day. Then you don’t have to …………..and kill us.”",
	"The plan sounded well thought-out to the lion, so he ………….., but he also said, “If you don’t come every day, I …………..to kill all of you the next day!”",
	"Each day after that, one animal went to the lion so that the lion could eat it. Then, all the other animals were …………...",
	"………….., it was the rabbit’s turn to go to the lion. The rabbit went very slowly that day, so the lion was …………..when the rabbit ﬁnally …………...",
	"The lion angrily asked the rabbit, “ Why are you late?”",
	"“I was …………..from another lion in the forest. That lion said he was the king, so I was afraid.”",
	"The lion told the rabbit, “ I am the only king here! Take me to that other lion, and I will kill him.",
	"The rabbit ………….., “ I will be happy to show you where he lives.”",
	"The rabbit led the lion to an old well in the ………….. of the forest. The well was very deep with water at the …………... The rabbit told the lion, “ Look in there. The lion lives at the bottom.”",
	"When the lion looked in the well, he could see his own face in-the water. He thought that was the other lion.",
	"Without waiting another ………….., the lion jumped into the well to …………..the other lion. He never came out.",
	"All of the other animal in the forest-were very pleased with the rabbit’s clever trick."
	],
	vi: 
	'1.1 SƯ TỬ VÀ THỎ<p></p>Một con Sư Tử <b>cruel</b> sống trong rừng. Hằng ngày, nó giết và ăn rất <b>lot</b> loài vật. Muông thú <b>afraid</b> rằng Sư Tử sẽ giết là ăn thịt tất cả loài vật trong khu rừng.<p></p> Chúng nói với Sư Tử rằng: "Chúng ta hãy thỏa thuận. Nếu ngày <b>promise</b> rằng mỗi ngày ngài chỉ ăn một con vật, thì hàng ngày một trong số chúng tôi sẽ tới đây nộp mạng. Ngài sẽ không phải <b>hunt</b> và giết chúng tôi nữa". <p></p> Sư Tử thấy thỏa thuận nghe rất <b>well</b> nên nó đã <b>agreed</b>, nhưng nó cũng nói rằng: "Nếu mỗi ngày không có một đứa tới nạp mạng, tao <b>promise</b> sẽ giết tất cả chúng mày vào ngày hôm sau!".<p></p> Cứ như vậy, mỗi ngày một con vật lại tới nộp mạng cho Sư Tử. Và như thế, tất cả muôn loài đề <b>safe</b>.<p></p> <b>Finally</b>, đến lượt Thỏ tới nộp mạng cho Sư Tử. Thỏ hôm đó tới rất muộn nên Sư Tử đã rất <b>angry</b> khi thỏ <b>arrived</b>.<p></p> Sư Tử tức giận hỏi Thỏ: "Tại sao mày lại tới muộn?"<p></p> "Tôi đã <b>hiding</b> khỏi một con Sư Tử khác trong rừng. Con Sư Tử đó là chúa sơn lâm, nên tôi rất sợ hãi".<p></p> "Tao là chúa sơn lâm duy nhất trong khu rừng này. Đưa tao tới gặp con Sư Tử đó, tao sẽ giết chết nó" - Sư Tử nói với Thỏ.<p></p> Thỏ <b>replied</b>: "Tôi rất vui mừng chỉ cho ngài nơi hắn sống".<p></p> Thỏ đưa Sư thử tới một chiếc giếng cũ ở <b>middle</b> khu rừng. Chiếc giếng sâu hun hút và có nước ở <b>bottom</b>. Thỏ nói với Sư Tử: "Ngài hãy nhìn vào trong này. Hắn sống ở dưới đáy kia kìa". Khi Sư Tử nhìn xuống đấy giếng, nó thấy chính khuôn mặt mình in trên mặt nước. Nó nghĩ đó là con Sư Tử kia. Không đợi một <b>moment</b> nào, Sư Tử nhảy xuống giếng để <b>attack</b> con Sư Tử kia. Nó không bao giờ có thể thoát ra được nữa.<p></p> Tất cả các loài vật trong rừng đều rất pleased với clever trick của Thỏ.'
},

// 361 words

	   ];


    $scope.story = $scope.stories[$scope.storyIdx];

	$scope.fetchStory = function (index) {
		$scope.storyIdx = $scope.storyIdx + index;
		$scope.story = $scope.stories[$scope.storyIdx];
	}

	$scope.playSentence = function (index) {
		$scope.stopSound();
  		$scope.audio = new Audio("truyenchem/" + $scope.storyIdx + "/" + $scope.storyIdx + '.' + index + '.mp3');
	    $scope.audio.loop = false;
	    $scope.audio.play();
	}

	$scope.playFullSound = function (index) {
		if ($scope.bPlaying)
		{
			$scope.pauseSound();
		}
	  	else
	  	{
	  		$scope.audio = new Audio("truyenchem/" + index + "/" + index + '.full.mp3');
		    $scope.audio.loop = false;
		    $scope.audio.play();
	  	}
	    $scope.bPlaying = true;
	}

	$scope.pauseSound = function () {
		if (!$scope.audio) return;
		$scope.bPause = !$scope.bPause;
		if ($scope.bPause)
	    {
	    	$scope.audio.pause();
	    	$scope.currentTime = $scope.audio.currentTime;
	    }
	    else
	    {
	    	$scope.audio.currentTime = $scope.currentTime;
	    	$scope.audio.play();
	    }
	}

	$scope.stopSound = function () {
		if (!$scope.audio) return;
		 $scope.audio.pause();
		 $scope.audio.currentTime = 0;
		 $scope.currentTime = 0;
		 $scope.bPlaying = false
	};

    });

</script>
</html>
